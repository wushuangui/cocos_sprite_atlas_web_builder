# Cocos Creator 图集生成器

一个基于Web的Cocos Creator图集生成工具，支持将散图快速合成为Cocos兼容的图集文件。

## 功能特性

- ✅ **拖拽上传**：支持拖拽或点击上传多张图片
- ✅ **智能打包**：优化的Shelf算法和MaxRectangles算法，高空间利用率
- ✅ **多算法支持**：可选择Shelf或MaxRectangles算法进行打包
- ✅ **2的幂次方支持**：可选2的幂次方尺寸或原始尺寸
- ✅ **自动旋转**：智能90度旋转，提升空间利用率
- ✅ **实时预览**：即时查看图集效果
- ✅ **一键导出**：支持ZIP压缩包或单独文件导出
- ✅ **多种排序**：14种排序策略，自动选择最优结果

## 项目结构

```
cocos_sprite_atlas_web_builder/
├── index.html              # 主页面
├── README.md              # 项目说明
├── css/
│   └── styles.css         # 样式文件
├── js/
│   ├── atlasPacker.js            # Shelf图集打包算法
│   ├── maxRectanglesPacker.js   # MaxRectangles图集打包算法
│   ├── app.js                  # 主应用程序
│   └── FileSaver.js           # 文件保存工具
├── lib/
│   └── jszip.min.js      # JSZip库
├── tests/
│   ├── test_atlas.html    # 完整算法测试
│   ├── test_simple.html   # 简单功能测试
│   └── test_algorithm.js # 算法测试脚本
└── docs/
    ├── OPTIMIZATION_REPORT.md  # 优化报告
    └── TESTING_GUIDE.md        # 测试指南
```

## 快速开始

### 方法1：直接打开

1. 双击 `index.html` 在浏览器中打开
2. 拖拽图片到上传区域
3. 配置参数后点击"生成图集"
4. 点击"下载图集"导出

### 方法2：使用本地服务器

```bash
# 使用Python
python -m http.server 8080

# 使用Node.js http-server
npx http-server -p 8080

# 使用PHP
php -S localhost:8080
```

然后在浏览器中访问 `http://localhost:8080`

## 使用说明

### 基本参数

- **图集名称**：生成的PNG和PLIST文件名
- **图片间距**：图集中图片之间的间距（像素）
- **最大宽度**：图集的最大宽度（像素）
- **2的幂次方**：是否使用2的幂次方尺寸（2048、1024、512等）

### 高级功能

#### 打包算法选择

- **MaxRectangles（推荐）**：业界最优算法，提供最佳空间利用率
  - 适合：大量图片、复杂尺寸混合的场景
  - 特点：空间利用率最高，处理速度快

- **Shelf（传统）**：增强优化的货架算法
  - 适合：图片数量较少、尺寸相对规整的场景
  - 特点：处理速度快，空间利用率良好

### 2的幂次方模式

**启用时**：
- 生成2的幂次方尺寸（如2048×1024）
- 兼容大多数游戏引擎
- 适合纹理压缩

**禁用时**：
- 生成原始尺寸（如1623×805）
- 空间利用率更高
- 节省存储空间

### 导出格式

- **ZIP压缩包**：包含PNG和PLIST文件，一键下载
- **单独文件**：分别下载PNG和PLIST文件

## 算法说明

### MaxRectangles算法（推荐）

业界最优的矩形打包算法，具有以下特点：

1. **最佳空间利用率**：通过维护空闲矩形列表，选择最佳位置放置图片
2. **智能放置策略**：使用Best Short Side Fit启发式算法
3. **自动旋转**：智能判断旋转是否能提升空间利用率
4. **动态分割**：自动分割空闲矩形，最大化空间利用
5. **高效率**：适合处理大量图片

### Shelf算法（货架算法）

增强优化的Shelf算法，具有以下特点：

1. **智能评分**：综合考虑waste、widthFit、shelfUtilization和底部优先
2. **多轮尝试**：3轮尝试，每轮使用不同排序策略
3. **动态高度**：基于众数、中位数等多策略选择最优shelf高度
4. **智能合并**：动态阈值判断是否合并相邻shelf
5. **旋转优化**：智能判断旋转是否能提升空间利用率

### 排序策略

共14种排序策略：
- 面积降序/升序
- 宽度降序/升序
- 高度降序/升序
- 最大边降序/升序
- 最小边降序/升序
- 长宽比降序/升序
- 周长降序/升序

## 性能基准

### MaxRectangles算法

| 图片数量 | 处理时间 | 利用率（2的幂次方） | 利用率（原始） |
|---------|---------|-------------------|--------------|
| 1-5     | < 30ms  | 70-85%            | 80-90%       |
| 6-15    | < 150ms | 75-88%            | 85-93%       |
| 16-30   | < 400ms | 80-90%            | 88-95%       |
| 31-50   | < 800ms | 82-92%            | 90-96%       |

### Shelf算法

| 图片数量 | 处理时间 | 利用率（2的幂次方） | 利用率（原始） |
|---------|---------|-------------------|--------------|
| 1-5     | < 50ms  | 60-75%            | 75-85%       |
| 6-15    | < 200ms | 70-80%            | 80-90%       |
| 16-30   | < 500ms | 75-85%            | 85-95%       |
| 31-50   | < 1000ms| 78-88%            | 88-95%       |

## 支持的图片格式

- PNG
- JPG / JPEG
- 支持多图同时上传

## 浏览器兼容性

- Chrome 90+
- Firefox 88+
- Edge 90+
- Safari 14+

## 测试

### 完整算法测试

打开 `tests/test_atlas.html`，测试：
- 12张预设图片
- 实时性能测试
- 详细算法日志

### 简单功能测试

打开 `tests/test_simple.html`，快速验证：
- 算法基本功能
- 两种模式对比
- 无错误验证

详细测试指南请参考 `docs/TESTING_GUIDE.md`

## 技术栈

- 原生JavaScript（ES6+）
- HTML5 Canvas
- CSS3
- JSZip（文件压缩）

## 输出格式

### PNG文件

- 标准PNG格式
- 包含所有合成的图片
- 支持透明通道

### PLIST文件

遵循Cocos Creator SpriteAtlas格式：

```xml
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd">
<plist version="1.0">
<dict>
  <key>frames</key>
  <dict>
    <!-- 每个图片的信息 -->
  </dict>
  <key>metadata</key>
  <dict>
    <key>format</key>
    <integer>2</integer>
    <key>size</key>
    <string>{width,height}</string>
    <key>textureFileName</key>
    <string>atlas.png</string>
  </dict>
</dict>
</plist>
```

## 注意事项

1. **图片大小限制**
   - 单张图片最大尺寸：2048×2048
   - 超过限制将无法生成

2. **图片数量建议**
   - 少量图片（< 50）：快速响应
   - 中量图片（50-200）：响应时间可接受
   - 大量图片（> 200）：考虑分多图集

3. **间距设置**
   - 建议：2-4像素
   - 过大：浪费空间
   - 过小：可能导致纹理采样问题

## 故障排除

### 图集生成失败

**原因**：
- 图片尺寸超过最大宽度限制
- 图片格式不支持
- 内存不足

**解决方法**：
- 增加最大宽度
- 检查图片格式
- 减少同时处理的图片数量

### 图片显示异常

**原因**：
- 旋转图片显示不正确
- 坐标计算错误

**解决方法**：
- 使用"测试面板"验证纹理
- 检查PLIST文件内容
- 确认Cocos Creator版本兼容性

## 更新日志

### v3.0 Advanced (2025)
- ✨ 新增MaxRectangles算法（业界最优）
- ✨ 支持算法选择（MaxRectangles/Shelf）
- 📝 更新文档和使用指南

### v2.0 Enhanced (2025)
- ✨ 增强的Shelf评分策略
- ✨ 智能旋转决策
- ✨ 多策略shelf高度选择
- ✨ 改进的合并策略
- ✨ 增加多轮尝试（2轮→3轮）
- ✨ 扩展排序策略（8种→14种）
- ✨ 优化宽度选项选择
- ✨ 新增2的幂次方选项
- 📝 完善文档和测试

### v1.0 Initial
- 🎉 基本图集生成功能
- 🎉 拖拽上传
- 🎉 图集预览
- 🎉 PLIST导出
