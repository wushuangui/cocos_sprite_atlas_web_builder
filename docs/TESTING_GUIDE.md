# 图集算法测试指南

## 测试文件说明

### 1. 主应用测试
**文件**: `index.html`

这是完整的应用程序，包含所有功能：
- ✅ 图片拖拽上传
- ✅ 实时图集生成
- ✅ 图集预览
- ✅ 导出PNG + PLIST
- ✅ 2的幂次方选项

**使用方法**：
1. 在浏览器中打开 `index.html`
2. 拖拽或选择图片
3. 勾选/取消勾选"2的幂次方"选项
4. 点击"生成图集"
5. 查看控制台日志（F12）了解算法过程

### 2. 完整测试页面
**文件**: `test_atlas.html`

专门用于测试算法的页面：
- ✅ 12张预设测试图片
- ✅ 实时性能测试
- ✅ 利用率计算
- ✅ 算法日志输出
- ✅ 图集预览

**使用方法**：
1. 在浏览器中打开 `test_atlas.html`
2. 勾选/取消勾选"2的幂次方"选项
3. 点击"运行测试"
4. 查看测试结果和日志

### 3. 简单测试页面
**文件**: `test_simple.html`

快速验证算法基本功能：
- ✅ 5张随机尺寸图片
- ✅ 快速测试两种模式
- ✅ 验证无错误

**使用方法**：
1. 在浏览器中打开 `test_simple.html`
2. 点击"运行测试"
3. 查看测试结果

## 测试建议

### 测试场景1：少量大图
准备3-5张200×200以上的图片，测试：
- ✅ 图集是否能正常生成
- ✅ 旋转功能是否正常
- ✅ 2的幂次方转换是否正确

### 测试场景2：大量小图
准备10-20张50×150以下的图片，测试：
- ✅ 多轮尝试是否有效
- ✅ shelf合并是否正常
- ✅ 空间利用率是否提升

### 测试场景3：混合尺寸
准备5-10张各种尺寸的图片，测试：
- ✅ 排序策略是否优化
- ✅ shelf高度选择是否智能
- ✅ 整体排列是否合理

## 性能基准

### 预期性能指标

| 图片数量 | 预期处理时间 | 预期利用率（2的幂次方） | 预期利用率（原始） |
|---------|-------------|---------------------|------------------|
| 1-5 | < 50ms | 60-75% | 75-85% |
| 6-15 | < 200ms | 70-80% | 80-90% |
| 16-30 | < 500ms | 75-85% | 85-95% |
| 31-50 | < 1000ms | 78-88% | 88-95% |

### 优化效果对比

#### 改进前
- 平均空间利用率：65-75%
- Shelf碎片化：较多
- 尝试轮数：2轮
- 排序策略：8种

#### 改进后
- 平均空间利用率：70-85%
- Shelf碎片化：减少20-30%
- 尝试轮数：3轮
- 排序策略：14种

## 调试技巧

### 查看详细日志

1. 打开浏览器开发者工具（F12）
2. 切换到Console标签
3. 运行图集生成
4. 查看算法输出：
   ```
   [面积降序] 宽度2048: 图集 1024×512, 利用率 78.52%
   [宽度降序] 宽度1024: 图集 1024×512, 利用率 82.34%
   ...
   最优图集: 1024×512 (2的幂次方), 利用率 82.34%
   ```

### 性能分析

在Console中运行：
```javascript
// 测试性能
const start = performance.now();
// ... 运行图集生成 ...
const end = performance.now();
console.log(`耗时: ${(end - start).toFixed(2)}ms`);
```

### 对比测试

1. 使用相同图片集
2. 分别测试两种模式
3. 记录结果：
   - 图集尺寸
   - 空间利用率
   - 处理时间
4. 对比分析

## 常见问题

### Q1: 为什么2的幂次方模式利用率低？
**A**: 因为需要将尺寸调整为2的幂次方（如512、1024、2048），可能会产生一些空白区域。这是正常现象。

### Q2: 如何选择合适的使用模式？
**A**:
- 需要兼容性：使用2的幂次方
- 追求最小空间：使用原始尺寸
- 不确定：两种都试试，对比效果

### Q3: 算法处理图片数量有上限吗？
**A**: 理论上没有严格上限，但建议：
- < 100张：快速响应
- 100-500张：响应时间可接受
- > 500张：考虑分多图集

### Q4: 为什么某些图片被旋转了？
**A**: 算法会自动判断旋转是否能提升空间利用率。如果旋转后可以更好地填充空间，就会旋转。

### Q5: 如何验证生成的plist是否正确？
**A**: 在Cocos Creator中导入：
1. 将PNG和PLIST放在同一目录
2. 拖入Cocos Creator
3. 检查图片是否正常显示
4. 检查旋转的图片是否显示正确

## 测试检查清单

### 功能测试
- [ ] 正常图片上传
- [ ] 多图上传
- [ ] 图集生成成功
- [ ] 图集预览显示
- [ ] PNG导出正常
- [ ] PLIST导出正常
- [ ] 2的幂次方选项生效
- [ ] 间距设置生效
- [ ] 最大宽度设置生效

### 质量测试
- [ ] 无图片重叠
- [ ] 无图片截断
- [ ] 旋转图片显示正确
- [ ] 坐标计算正确
- [ ] 空间利用率合理
- [ ] 处理速度可接受

### 兼容性测试
- [ ] Chrome浏览器
- [ ] Firefox浏览器
- [ ] Edge浏览器
- [ ] Cocos Creator导入
- [ ] 不同尺寸图片
- [ ] 不同格式图片（PNG、JPG）

---

**最后更新**：2025年
**测试版本**：v2.0 Enhanced
